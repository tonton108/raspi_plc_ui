{% extends "base.html" %}
{% block title %}ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°{% endblock %}
{% block content %}
<div class="container">
  <h1>PLCãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°</h1>

  <div class="status">
    <p><strong>æ¥ç¶šå…ˆ:</strong> {{ config.manufacturer }} @ {{ config.ip }}:{{ config.port }}</p>
    <p><strong>çŠ¶æ…‹:</strong>
      {% if status == "ç¨¼åƒ" %}âœ… ç¨¼åƒä¸­
      {% elif status == "åœæ­¢" %}â›” åœæ­¢ä¸­
      {% else %}â¸ï¸ ä¸€æ™‚åœæ­¢
      {% endif %}
    </p>
    <p><strong>ã‚µã‚¤ã‚¯ãƒ«ã‚¿ã‚¤ãƒ :</strong> {{ cycle_time }} ç§’</p>
  </div>

  <form method="get" action="/equipment_config">
    <button type="submit">âš™ï¸ æ¥ç¶šè¨­å®š</button>
  </form>

  <form onsubmit="event.preventDefault(); testConnection();">
    <button>ğŸ§ª æ¥ç¶šãƒ†ã‚¹ãƒˆ</button>
    <p id="test-result">æœªå®Ÿè¡Œ</p>
  </form>
</div>

<script>
async function testConnection() {
  const res = await fetch('/test-connection', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      ip: "{{ config.ip }}",
      port: "{{ config.port }}",
      manufacturer: "{{ config.manufacturer }}"
    })
  });
  const result = await res.json();
  document.getElementById('test-result').textContent = result.success ? "æ¥ç¶šæˆåŠŸï¼" : "æ¥ç¶šå¤±æ•—...";
}
</script>
{% endblock %}
